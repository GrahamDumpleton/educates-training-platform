#@ load("@ytt:data", "data")
#@ load("@ytt:yaml", "yaml")
#@ load("@ytt:base64", "base64")

---
apiVersion: v1
kind: Secret
metadata:
  name: #@ "{}-config".format(data.values.operator.namePrefix)
  namespace: #@ data.values.operator.namespace
  annotations:
    kapp.k14s.io/versioned: ""
    kapp.k14s.io/num-versions: "5"
#@ if data.values.ingressDomain == "local.educates.dev":
stringData:
  values.yaml: #@ yaml.encode(data.values)
#@ else:
data:
  values.yaml: #@ base64.encode(data.values)
#@ end

#@ ingress_certificate = getattr(data.values.tlsCertificate, "tls.crt")
#@ ingress_private_key = getattr(data.values.tlsCertificate, "tls.key")
#@ ingress_secret_ref_name = data.values.tlsCertificateRef.name

---
#@ if not ingress_secret_ref_name and ingress_certificate and ingress_private_key:
apiVersion: v1
kind: Secret
metadata:
  name: #@ "{}-tls".format(data.values.ingressDomain)
  namespace: #@ data.values.operator.namespace
type: kubernetes.io/tls
data:
  tls.crt: #@ base64.encode(ingress_certificate)
  tls.key: #@ base64.encode(ingress_private_key)
#@ end
