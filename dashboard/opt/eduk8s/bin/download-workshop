#!/bin/bash

DOWNLOAD_URL=$1

if [ "$#" -lt 1 -o -z "$DOWNLOAD_URL" ]; then
  echo "Usage: $0 DOWNLOAD_URL" >&2
  exit 1
fi

GITHUB_RE_1="^https:\/\/github\.com\/([^\/]+)\/([^\/]+)(\/[^#]+)?#?(.*)?$"

if [[ $DOWNLOAD_URL =~ $GITHUB_RE_1 ]]; then
    ORGANIZATION=${BASH_REMATCH[1]}
    REPOSITORY=${BASH_REMATCH[2]}
    WORKSHOP_PATH=${BASH_REMATCH[3]:-/workshop}
    REPOSITORY_REF=${BASH_REMATCH[4]:-master}

    DOWNLOAD_URL="https://github.com/$ORGANIZATION/$REPOSITORY/archive/$REPOSITORY_REF.tar.gz"
fi

GITHUB_RE_2="^https:\/\/github\.com\/.*?$"

if [[ $DOWNLOAD_URL =~ $GITHUB_RE_2 ]]; then
    TAR_EXTRACT_ARGS="--strip-components 1"
fi

curl -sL -o /tmp/download.tar.gz $DOWNLOAD_URL

tar -C /home/eduk8s $TAR_EXTRACT_ARGS -xvf /tmp/download.tar.gz
